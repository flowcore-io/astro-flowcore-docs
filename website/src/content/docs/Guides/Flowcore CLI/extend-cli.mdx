---
title: Extend the Flowcore CLI
sidebar:
  order: 5
description: How to extend the Flowcore CLI to fit your needs.
---
import { Card, TabItem, Tabs } from '@astrojs/starlight/components';
import { Image } from "astro:assets";

import StreamCommand from "../../../../assets/guides/flowcore-cli/stream-cli/stream-command.png";
import StreamDialog from "../../../../assets/guides/flowcore-cli/stream-cli/stream-dialog.png";

The Flowcore CLI allows you to stream data from Flowcore. You can extend the CLI and add your own commands to fit your needs.

## Add a new plugin

To create a new plugin you can use the flowcore cli

```sh
flowcore new plugin <plugin-name>
```

then you can link the plugin to the flowcore cli to test it

```sh
flowcore plugins link <path to plugin directory>
```

rename the topic to the topic you want to create a command for, for example `stream`.

:::tip[Locations]

The commands are located in the `src/commands/<topic>/<command-name>.ts` directory and in the package.json file in the `oclif` section.

:::

if you run `flowcore --help` you should see your new command in the list.

## Stream

To create a new stream output you need to add the `@flowcore/cli-plugin-core` package to your plugin.

<Tabs>
  <TabItem label="yarn">
    ```sh frame=none
    yarn add @flowcore/cli-plugin-core
    ```
  </TabItem>
  <TabItem label="npm">
    ```sh frame=none
    npm install @flowcore/cli-plugin-core
    ```
  </TabItem>
</Tabs>

then you can create a new command under the `src/commands/stream` directory.

<Tabs>
  <TabItem label="src/services/emoji.service.ts">
    ```ts frame=none
    import { OutputService, SourceEvent, StreamFlags } from "@flowcore/cli-plugin-core";
    import { ux } from "@oclif/core";

    export class EmojiService implements OutputService {

      // this is called when the stream is done, but only if the stream is not live
      async done(): Promise<void> {
        console.log(ux.colorize("green", "Done!!! ðŸ¥³"))
      }

      // this is the description of the output processor, used in the help command
      getDescription(): string {
        return "Emojify the output"
      }

      // this is the name of the output processor
      getName(): string {
        return "emojify"
      }

      // this is called for each event in the stream
      async process(event: SourceEvent, streamFlags: StreamFlags): Promise<void> {
        const emojiEvent = {
          ...event,
          emoji: "ðŸ˜Ž",
        }
        console.log(JSON.stringify(emojiEvent))
      }
    }
    ```
  </TabItem>
  <TabItem label="src/commands/stream/emojify.ts">
    ```ts frame=none
    // src/commands/stream/emojify.ts
    import { Flags } from "@oclif/core"
    import dayjs from "dayjs"
    import customParseFormat from "dayjs/plugin/customParseFormat.js"

    import { BaseStreamCommand } from "@flowcore/cli-plugin-core"
    import { EmojiService } from "../../services/emoji.service.js"

    dayjs.extend(customParseFormat)

    export default class EmojifyStream extends BaseStreamCommand<typeof BaseStreamCommand> {
      static args = BaseStreamCommand.args

      static description = "Emojify the output"
      static examples = [
        '<%= config.bin %> <%= command.id %> "https://flowcore.io/<org>/<data core>/*" -s 1y --no-live',
      ]

      static flags = {
        ...BaseStreamCommand.flags,
        // add flags to the command to pass to the output processor
      }

      public async init(): Promise<void> {
        await super.init()

        const { flags } = await this.parse(EmojifyStream)

        const emojiService = new EmojiService()

        // register the emoji service as an output processor
        this.streamService.registerOutputProcessor(emojiService)
      }

      public async run(): Promise<void> {
        const { args, flags } = await this.parse(EmojifyStream)

        // initialize the stream service with the stream url and the output processor
        await this.streamService.init(args.STREAM, {
          ...flags,
          output: "emojify",
        })

        await this.streamService.startStream()
      }
    }
    ```
  </TabItem>
</Tabs>

then you can run the command

```sh
flowcore stream emojify <STREAM URL> --no-live
```

and you should see the output logged to the console with the ðŸ˜Ž emoji in each event, and a done message at the end.

:::caution[Important]
  The assumption is that you are familiar with the oclif framework and the flowcore cli. If you are not, we suggest you read the [oclif documentation](https://oclif.io/docs/introduction.html) and the [flowcore cli documentation](/guides/flowcore-cli/4stream-cli/).
:::